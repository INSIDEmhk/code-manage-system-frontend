<style scoped>
	.admin-page {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		width:637.5rpx;
		margin: auto; /* è‡ªåŠ¨å±…ä¸­ */
	}
	
	
	
	
	.error-pop {
	    position: fixed;
		left: 20%; /* æ°´å¹³å±…ä¸­ */
	    top: -500rpx; /* é»˜è®¤éšè—åœ¨é¡¶éƒ¨ä»¥å¤– */
		width:60%;
	    background-color: #ff4d4f;
	    color: white;
	    font-size: 32rpx;
	    text-align: center;
	    line-height: 100rpx;
	    height: 100rpx;
	    z-index: 3000;
	    box-shadow: 0rpx 8rpx 12rpx rgba(0, 0, 0, 0.1);
	    transition: top 0.3s ease; 
		border-radius:20rpx;
	}
	
	.error-pop.active {
	    top: 105rpx; 
	}
	
	
	
	
	
	.header{
		padding-top:80rpx;
		display: flex;
		flex-direction: row;
		align-items: center;
		justify-content: center;
		/* border: 1px solid green; */
		width: 100%; 
		margin-bottom:60rpx;
	}
	
	.text-area{
		width: 100%; 
		text-align: left; 
		padding-left: 20rpx; 
		font-size: 28rpx; 
		font-weight: bold; 
		margin-top: 80rpx;
		padding-bottom: 30rpx; 
		margin-bottom:40rpx;
		display:flex;
		flex-direction:row;
	}
	
	.text{
		font-size:34rpx; 
		flex-grow: 1; /* å æ®å‰©ä½™ç©ºé—´ï¼Œè®©è¡Œå†…å‰©ä½™å…ƒç´ ç´§é å³ä¾§ */
	}
	
	
	
	
	
	
	
	.backup-schedule {
		margin-top: 30rpx;
		padding: 20rpx;
		background-color: #f0f0f0;
		border-radius: 10rpx;
		text-align: center;
		width: 90%;
		height:300rpx;
		margin-bottom: 60rpx;
		display: flex;
		flex-direction: column;  /* è®¾ç½®å‚ç›´æ’åˆ— */
	}
	
	.backup-schedule-text {
		margin-top:40rpx;
		font-size: 35rpx;
		font-weight: 549;
		color: black;
		margin-bottom: 85rpx;
	}
	
	.backup-schedule-text1 {
		font-size: 20rpx;
		font-weight: 549;
		color: gray;
		line-height: 38rpx; /* å¢åŠ è¡Œè· */
	}
	
	
	
	
	
	
	
	/* â€œä¿®æ”¹å¯†ç â€æŒ‰é’® */
	.modify-password-button{
		background-color: #555555;
		color: white; 
		width:200rpx;
		height:60rpx;
		border: none; 
		border-radius: 5px; 
		cursor: pointer; 
		line-height: 60rpx; 
		margin-top: 20rpx;
		text-align: center;
		font-size: 30rpx;
	}
/* 	.modify-password-button {
		background-color: #3388ff;
		color: white;
		width: 200rpx;
		height: 60rpx;
		border: none;
		border-radius: 15rpx;
		font-size: 28rpx;
		text-align: center;
		line-height: 60rpx;
		margin-top: -10rpx;
		margin-bottom:120rpx;
		cursor: pointer;
	}
	
	.modify-password-button:active{
		background-color: #0056b3; 
		border: none; 
	} */
	
	
	
	
	/* ä¿®æ”¹å¯†ç å¼¹çª— */
	.modify-password-modal {
	    position: fixed;
	    top: 0;
	    left: 0;
	    width: 100%;
	    height: 100%;
	    background-color: rgba(0, 0, 0, 0.5);  /* é®ç½©å±‚ */
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    z-index: 1002;
	}
	
	/* å¼¹çª—å†…å®¹ */
	.modal-content1 {
	    width: 80%;
	    background-color: white;
	    border-radius: 10rpx;
	    padding: 30rpx;
	    text-align: center;
	    box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.2);
	    animation: slideIn 0.4s ease-out;
	}
	.userId-container {
	    display: flex;
	    align-items: center;  /* å‚ç›´å±…ä¸­å¯¹é½è¾“å…¥æ¡†å’ŒæŒ‰é’® */
	    margin-bottom: 40rpx;
		max-width: 533rpx;
	}
	
	/* å¯†ç è¾“å…¥æ¡†å’ŒæŒ‰é’®å®¹å™¨ */
	.password-container {
	    display: flex;
	    align-items: center;  /* å‚ç›´å±…ä¸­å¯¹é½è¾“å…¥æ¡†å’ŒæŒ‰é’® */
	    margin-bottom: 20rpx;
	}
	
	/* å¯†ç æ˜¾ç¤º/éšè—æŒ‰é’® */
	.password-toggle-button {
	    background-color: transparent;
	    border: none;
	    font-size: 28rpx;
	    color: #007bff;
	    cursor: pointer;
	    padding: 5rpx 10rpx;
	    border-radius: 5rpx;
	    display: inline-flex;
	    align-items: center;
	    justify-content: center;
	    transition: color 0.3s ease;
	    outline: none;
	}
	
	.password-toggle-button:after{
		border:none;
	}
	
	.password-toggle-button .icon {
	    /* margin-right: 5rpx; */
		margin-left: 10rpx; /* è®©å›¾æ ‡å’Œè¾“å…¥æ¡†ä¹‹é—´æœ‰ç‚¹é—´è· */
	}
	
	
	
	
	
	
	
	
	
	
	
	
	/* â€œç™»å‡ºâ€æŒ‰é’® */
	.logout-button{
		background-color: black;
		color: white; 
		width:160rpx;
		height:70rpx;
		border: none; 
		border-radius: 10px; 
		cursor: pointer; 
		line-height: 70rpx; 
	}
	/* ç™»å‡ºç¡®è®¤å¼¹çª— */
	.logout-confirm-modal {
	    position: fixed;
	    top: 0;
	    left: 0;
	    width: 100%;
	    height: 100%;
	    background-color: rgba(0, 0, 0, 0.5);
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    z-index: 1001;
	}
	
	
	
	
	
	
	
	.action-button {
	    background-color: lightseagreen;
	    color: white;
	    width: 440rpx;
	    height: 80rpx;
	    margin-bottom: 60rpx;
	    border-radius: 20rpx;
	    font-size: 28rpx;
	    text-align: center;
		line-height: 80rpx; /* ç¡®ä¿æ–‡å­—å‚ç›´å±…ä¸­ */
	}
	
	.action-button1 {
	    background-color: lightseagreen;
	    color: white;
	    width: 440rpx;
	    height: 80rpx;
	    margin-bottom: 180rpx;
	    border-radius: 20rpx;
	    font-size: 28rpx;
	    text-align: center;
		line-height: 80rpx; /* ç¡®ä¿æ–‡å­—å‚ç›´å±…ä¸­ */
	}
	
	.action-button2 {
	    background-color: #222222;
	    color: white;
	    width: 320rpx;
	    height: 80rpx;
	    margin-bottom: 120rpx;
	    border-radius: 20rpx;
	    font-size: 28rpx;
	    text-align: center;
		line-height: 80rpx; /* ç¡®ä¿æ–‡å­—å‚ç›´å±…ä¸­ */
	}

	
	
	
	
	
	
	/* ç¡®è®¤å¼¹çª—é®ç½©å±‚ */
	.modal-overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.5);  
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: 2000;  
	}
	
	/* å¼¹çª—å†…å®¹ */
	.modal-content {
		width: 80%;
		background-color: white;
		border-radius: 10rpx;
		padding: 30rpx;
		text-align: center;
		box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.2); 
		animation: slideIn 0.4s ease-out;  
	}
	.modal-content2 {
		width: 80%;
		background-color: white;
		border-radius: 10rpx;
		padding: 30rpx;
		text-align: center;
		box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.2); 
	}
	
	
	/* æŒ‰é’®åŒºåŸŸ */
	.modal-buttons {
	  display: flex;
	  justify-content: space-around;
	  margin-top: 35rpx;
	}
	
	/* å¼¹çª—æŒ‰é’® */
	.modal-button {
	  width: 120rpx;
	  height: 60rpx;
	  border-radius: 10rpx;
	  font-size: 28rpx;
	  text-align: center;
	  line-height: 60rpx;
	  cursor: pointer;
	}
	
	/* ç¡®è®¤æŒ‰é’® */
	.confirm-button {
	  background-color: #28a745;  
	  background-color: #f44336;
	  color: white;
	}
	
	.confirm-button1 {
		background-color: #ff4d4f;
	    color: white;
	}
	
	/* å–æ¶ˆæŒ‰é’® */
	.cancel-button {
	  background-color: #ccc; 
	  color: black;
	}
	
	/* åŠ¨ç”»ï¼šä»ä¸Šåˆ°ä¸‹æ»‘å…¥ */
	@keyframes slideIn {
	  0% {
		transform: translateY(-50rpx);
		opacity: 0;
	  }
	  100% {
	    transform: translateY(0);
	    opacity: 1;
	  }
	}



	.info-label1 {
		font-size: 35rpx;
		font-weight: bold;
		margin-bottom: 80rpx;
		display: block;
		text-align: left;
	}
	
	.info-label {
		font-size: 28rpx;
		font-weight: bold;
		margin-bottom: 10rpx;
		display: block;
		text-align: left;
	}
	
	.info-input {
		box-sizing: border-box; 
		width: 100%;
		height: 60rpx;
		border: 1px solid #ccc;
		border-radius: 10rpx;
		padding: 0 10rpx;
		font-size: 24rpx;
		outline: none;
		text-align: left; /* å·¦å¯¹é½æ–‡æœ¬ */
	}



	
	
	
	
	/* åº•éƒ¨çš„å¯¼èˆªæ  */
	.footer-blank{
		height: 100rpx;
	}
	.footer {
	  display: flex;
	  flex-direction: row;
	  align-items: center;
	  justify-content: space-around;
	  position: fixed; /* å›ºå®šåœ¨é¡µé¢åº•éƒ¨ */
	  bottom: 0;
	  left: 0;
	  width: 100%;
	  height: 100rpx;
	  background-color: #f9f9f9;
	  border-top: 1px solid #e0e0e0;
	  box-shadow: 0 -2rpx 4rpx rgba(0, 0, 0, 0.1);
	}
	
	.footer-item {
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	  justify-content: center;
	  flex: 1;
	  color: #666666;
	  font-size: 28rpx;
	}
	
	.footer-item .icon {
	  font-size: 36rpx;
	  margin-bottom: 5rpx;
	}
	
	.footer-item .text {
	  font-size: 24rpx;
	}
</style>






<template>
	<view class="admin-page">
		<view class="error-pop" :class="{ active: this.errorMessage }" :style="{ backgroundColor: errorPopBackgroundColor }">{{ this.errorMessage }}</view>
		<view class="header">
		    <text class="text">æ‚¨å¥½ï¼å°Šæ•¬çš„ç®¡ç†å‘˜</text>
			
			<button @click="handleLogout" class="logout-button">ç™»å‡º</button>
		</view>
		
		
		  <!-- æ˜¾ç¤ºæ•°æ®åº“å¤‡ä»½å‘¨æœŸ -->
		  <view class="backup-schedule">
		    <text class="backup-schedule-text">å½“å‰æ•°æ®åº“å¤‡ä»½å‘¨æœŸï¼š{{ this.backupSchedule }}  ç§’<br></text>
			<text class="backup-schedule-text1">åœ¨æœåŠ¡å™¨æ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹<br>ç³»ç»Ÿå°†è‡ªåŠ¨è¿›è¡Œæ•°æ®åº“å¤‡ä»½</text>
		  </view>
		
		<button class="action-button" @click="handleSetBackupSchedule">è®¾ç½®æ•°æ®åº“å¤‡ä»½å‘¨æœŸ</button>
		<!-- <button class="action-button1" @click="handleDownloadBackupFile">ä¸‹è½½æ•°æ®åº“å¤‡ä»½æ–‡ä»¶</button> -->
		<button class="action-button1" @click="handleImmediateBackup">ç«‹å³å¤‡ä»½</button>

		<button @click="handleModifyPassword" class="modify-password-button">ä¿®æ”¹å¯†ç </button>






		<!-- ä¿®æ”¹å¯†ç å¼¹çª— -->
		<view v-if="showModifyPasswordModal" class="modify-password-modal">
		  <view class="modal-content1">
			<text class="info-label1">å¯†ç ä»…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿</text>
			
			<text class="info-label">è¾“å…¥å½“å‰ç®¡ç†å‘˜è´¦å·ï¼š</text>
			<view class="userId-container">
				<input v-model="userId" class="info-input" />
			</view>
			
			<!-- è¾“å…¥æ—§å¯†ç  -->
			<text class="info-label">è¾“å…¥æ—§å¯†ç ï¼š</text>
			<view class="password-container">
			  <input :type="showOldPassword ? 'text' : 'password'" v-model="oldPassword" class="info-input" />
			  <button @click="toggleOldPasswordVisibility" class="password-toggle-button">
					<text class="icon">{{ showOldPassword ? 'ğŸ”’' : 'ğŸ‘ï¸' }}</text>
			  </button>
			</view>

			<!-- è¾“å…¥æ–°å¯†ç  -->
			<text class="info-label">è¾“å…¥æ–°å¯†ç ï¼š</text>
			<view class="password-container">
			  <input :type="showNewPassword ? 'text' : 'password'" v-model="newPassword" class="info-input" />
			  <button @click="toggleNewPasswordVisibility" class="password-toggle-button">
					<text class="icon">{{ showNewPassword ? 'ğŸ”’' : 'ğŸ‘ï¸' }}</text>
			  </button>
			</view>

			<!-- è¾“å…¥ç¬¬äºŒéæ–°å¯†ç  -->
			<text class="info-label">å†è¾“å…¥ä¸€éæ–°å¯†ç ï¼š</text>
			<view class="password-container">
			  <input :type="showConfirmPassword ? 'text' : 'password'" v-model="confirmNewPassword" class="info-input" />
			  <button @click="toggleConfirmPasswordVisibility" class="password-toggle-button">
				<text class="icon">{{ showConfirmPassword ? 'ğŸ”’' : 'ğŸ‘ï¸' }}</text>
			  </button>
			</view>

			<!-- â€œç¡®è®¤â€æŒ‰é’®å’Œâ€œå…³é—­â€æŒ‰é’® -->
			<view class="modal-buttons">
			  <button class="modal-button confirm-button1" @click="confirmModifyPassword">ç¡®è®¤</button>
			  <button class="modal-button cancel-button" @click="closeModifyPasswordModal">å–æ¶ˆ</button>
			</view>
		  </view>
		</view>
		
		
		
		
		
		
		
		<!-- ç™»å‡ºç¡®è®¤å¼¹çª— -->
		<view v-if="showLogoutConfirm" class="logout-confirm-modal">
		  <view class="modal-content2">
		    <text>æ‚¨ç¡®å®šè¦ç™»å‡ºå—ï¼Ÿ</text>
		    <view class="modal-buttons">
		      <button class="modal-button confirm-button1" @click="confirmLogout">ç¡®å®š</button>
		      <button class="modal-button cancel-button" @click="closeLogoutConfirm">å–æ¶ˆ</button>
		    </view>
		  </view>
		</view>





		<!-- è®¾ç½®å¤‡ä»½å‘¨æœŸçš„å¼¹çª— -->
		<view v-if="showSetBackupScheduleModal" class="modal-overlay">
			<view class="modal-content">
				<text class="info-label">è¯·è¾“å…¥æ–°çš„å¤‡ä»½å‘¨æœŸ ï¼ˆ å•ä½ï¼šç§’ ï¼‰ï¼š</text>
				<input v-model="newBackupSchedule" class="info-input" type="number" />
				<view class="modal-buttons">
					<button class="modal-button confirm-button1" @click="setBackupScheduleRequest">ç¡®è®¤</button>
					<button class="modal-button cancel-button" @click="closeSetBackupScheduleModal">å–æ¶ˆ</button>
				</view>
			</view>
		</view>





		<!-- ä¸‹è½½æ•°æ®åº“å¤‡ä»½æ–‡ä»¶å¼¹çª— -->
<!-- 		<view v-if="showDownloadConfirmationModal" class="modal-overlay">
		  <view class="modal-content">
			<text>æ‚¨ç¡®å®šè¦ä¸‹è½½æ•°æ®åº“å¤‡ä»½æ–‡ä»¶å—ï¼Ÿ</text>
			<view class="modal-buttons">
			  <button class="modal-button confirm-button" @click="downloadBackupFileRequest">ç¡®è®¤</button>
			  <button class="modal-button cancel-button" @click="closeDownloadConfirmationModal">å–æ¶ˆ</button>
			</view>
		  </view>
		</view> -->
		
		<!-- ç«‹å³å¤‡ä»½å¼¹çª— -->
		<view v-if="showBackupConfirmationModal" class="modal-overlay">
		  <view class="modal-content">
			<text>æ‚¨ç¡®å®šè¦ç«‹å³è¿›è¡Œæ•°æ®åº“å¤‡ä»½å—ï¼Ÿ</text>
			<view class="modal-buttons">
			  <button class="modal-button confirm-button" @click="immediateBackupRequest">ç¡®è®¤</button>
			  <button class="modal-button cancel-button" @click="closeBackupConfirmationModal">å–æ¶ˆ</button>
			</view>
		  </view>
		</view>


		
		
		
		<!-- åº•éƒ¨å¯¼èˆªæ  -->
		<!-- æ·»åŠ ä¸€æ®µç©ºç™½æŒ¤å ç©ºé—´ï¼Œé˜²æ­¢footeråº•éƒ¨å¯¼èˆªæ é®æŒ¡ä½æœ€ä¸‹é¢çš„ä½œä¸š -->
		<view class="footer-blank"></view>
		<view class="footer">
			<view class="footer-item" @click="goToHome">
				<view class="icon">ğŸ“…</view>
				<view class="text">å­¦æœŸç®¡ç†</view>
			</view>
			<view class="footer-item" @click="goToTeachers">
				<view class="icon">ğŸ§‘â€ğŸ“</view>
				<view class="text">æ•™å¸ˆç®¡ç†</view>
			</view>
			<view class="footer-item" @click="goToProfile">
				<view class="icon">ğŸ‘¤</view>
				<view class="text" style="color:#ff4d4f">ç³»ç»Ÿç®¡ç†</view>
			</view>
		</view>
	</view>
</template>






<script>
	
	import { config } from '../../../config'; // å¯¼å…¥ config.js æ–‡ä»¶
	
	
export default {
    data() {
    	return {
			apiUrl: `http://${config.host}:${config.port}`, // ä½¿ç”¨é…ç½®çš„hostå’Œport
			
			
			who:"",
			
			
			
			
			// é¡¶éƒ¨å¼¹çª—
			errorMessage: "", 
			errorPopBackgroundColor: '#ff4d4f', // é”™è¯¯å¼¹çª—èƒŒæ™¯é¢œè‰²
			timeoutId: null,
			
			
			// æ˜¾ç¤ºä¿®æ”¹å¯†ç å¼¹çª—
			showModifyPasswordModal: false,
			showOldPassword: false,
			showNewPassword: false,
			showConfirmPassword: false,
			
			userId:"",
			oldPassword: "",
			newPassword: "",
			confirmNewPassword: "",
			
			
			
			// æ˜¾ç¤ºç™»å‡ºç¡®è®¤å¼¹çª—
			showLogoutConfirm: false,

			
			
			
			backupSchedule: "",	// å¤‡ä»½å‘¨æœŸ
			newBackupSchedule: "",  // ç”¨äºå­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å¤‡ä»½å‘¨æœŸ
			
			
			
			
			// æ˜¾ç¤ºè®¾ç½®æ•°æ®åº“å¤‡ä»½å‘¨æœŸå¼¹çª—
			showSetBackupScheduleModal: false,
			
			// ä¸‹è½½æ•°æ®åº“å¤‡ä»½æ–‡ä»¶å¼¹çª—
			showDownloadConfirmationModal: false, 
			
			// ç«‹å³å¤‡ä»½å¼¹çª—
			showBackupConfirmationModal: false,   

    	};
    },
	
	
	onLoad(query) {
		console.log(query.id);
		this.who=query.id;
		
		if(!this.who){
			// console.log('Debug: this.who is', this.who); 
			this.showError("è¯·å…ˆç™»å½•ï¼");
			uni.reLaunch({
				// (urlåæœŸéœ€è¦ä¿®æ”¹ï¼ï¼ï¼)
			    url: "/pages/index/login"
			});
			return;
		}
		
		this.loadBackupSchedule();
	},
	
	
	
	methods: {
		// å‘æœåŠ¡å™¨è·å–å¤‡ä»½å‘¨æœŸ(å•ä½æ˜¯åˆ†é’Ÿ)
		loadBackupSchedule(){
			uni.request({
				url: `${this.apiUrl}/admin/queryBackupInterval`,
				method: 'GET',
				success: (res) => {
					if(res.data.code==='000'){
						this.backupSchedule=res.data.data/1000;
					}
					else{
						this.showError("ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•", "#ff4d4f");
						this.backupSchedule="Null";
					}
				},
				fail: (err) => {
					this.showError("ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•", "#ff4d4f");
				},
				complete: () => {
					uni.hideLoading();
				}
			});
		},
		
		
		
		
		
		
		// ä¿®æ”¹å¯†ç 
		handleModifyPassword(){
			if(!this.who){
				// console.log('Debug: this.who is', this.who); 
				this.showError("è¯·å…ˆç™»å½•ï¼");
				return;
			}
			this.showModifyPasswordModal = true;
		},
		
		confirmModifyPassword() {
		    const validation = this.validatePasswordFormat(this.userId, this.oldPassword, this.newPassword, this.confirmNewPassword);
		    if (!validation.isValid) {
				this.showError(validation.message);
				return;
		    }
		    const passwordData = {
				// è´¦å·å­—æ®µ
				userId:this.userId,
				// å¯†ç å­—æ®µ
				oldPassword: this.oldPassword,
				newPassword: this.newPassword,
		    };
			
		    this.modifyPasswordRequest(passwordData);
		},
		  
		// éªŒè¯å¯†ç æ ¼å¼
		validatePasswordFormat(userId, oldPassword, newPassword, confirmNewPassword) {
			const passwordRegex = /^[A-Za-z0-9_]+$/;
			if (!userId || !oldPassword || !newPassword || !confirmNewPassword) {
				return { isValid: false, message: "è´¦å·å’Œå¯†ç å‡ä¸èƒ½ä¸ºç©º" };
			}
			if (newPassword !== confirmNewPassword) {
				return { isValid: false, message: "ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´" };
			}
			if (!passwordRegex.test(newPassword) || !passwordRegex.test(oldPassword)) {
				return { isValid: false, message: "å¯†ç åªå«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿" };
			}
			return { isValid: true, message: "" };
		},
		
		toggleOldPasswordVisibility() {
		    this.showOldPassword = !this.showOldPassword;
		},
		toggleNewPasswordVisibility() {
		    this.showNewPassword = !this.showNewPassword;
		},
		toggleConfirmPasswordVisibility() {
		    this.showConfirmPassword = !this.showConfirmPassword;
		},
		closeModifyPasswordModal() {
		    this.showModifyPasswordModal = false;
			this.userId	= "";
		    this.oldPassword = "";
		    this.newPassword = "";
		    this.confirmNewPassword = "";
		    this.showOldPassword = false;
		    this.showNewPassword = false;
		    this.showConfirmPassword = false;
		},
		  
		modifyPasswordRequest(passwordData){
			// å‘æœåŠ¡å™¨å‘é€ POST è¯·æ±‚ä¿®æ”¹å¯†ç 
			uni.showLoading({
			    title: 'æ­£åœ¨ä¿®æ”¹å¯†ç ...', // åŠ è½½åŠ¨ç”»çš„æç¤ºæ–‡å­—
			    mask: true // é˜»æ­¢ç‚¹å‡»èƒŒæ™¯æ—¶å…³é—­åŠ è½½æç¤º
			});
			uni.request({
				url: `${this.apiUrl}/changePassword`, 
			    method: 'POST',
			    data: passwordData, 
			    success: (res) => {
					if (res.data.code === '000') {
						this.showError("å¯†ç ä¿®æ”¹æˆåŠŸï¼", "#28a745");
						uni.showToast({
						    title: 'ä¿®æ”¹æˆåŠŸ',  // æç¤ºçš„æ–‡æœ¬
						    icon: 'success',       // å¯é€‰å€¼ï¼š'success', 'loading', 'none'ï¼Œåˆ†åˆ«è¡¨ç¤ºæˆåŠŸæç¤ºã€åŠ è½½æç¤ºå’Œæ²¡æœ‰å›¾æ ‡çš„æç¤º
						    duration: 1000      // æç¤ºæ¡†çš„æ˜¾ç¤ºæ—¶é•¿ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤2000ms
						});
					} 
					else {
						// å¦‚æœå¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
						this.showError(res.data.info);
					}
			    },
			    fail: () => {
					// è¯·æ±‚å¤±è´¥å¤„ç†
					this.showError("ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•");
			    },
				complete: () => {
					this.closeModifyPasswordModal();
					// éšè—åŠ è½½åŠ¨ç”»
					uni.hideLoading();
				}
			});
		},









		// ç™»å‡º
        handleLogout(){
			this.showLogoutConfirm = true;
		},
		
		closeLogoutConfirm() {
		    this.showLogoutConfirm = false;
		},
		confirmLogout() {
		    this.showLogoutConfirm = false;
		    uni.reLaunch({
		      url: "/pages/index/login",
		    });
		},
		
		
		
		
		
		
		
		// è®¾ç½®æ•°æ®åº“å¤‡ä»½å‘¨æœŸ
		handleSetBackupSchedule() {
			if(!this.who){
				// console.log('Debug: this.who is', this.who); 
				this.showError("è¯·å…ˆç™»å½•ï¼");
				return;
			}
			this.showSetBackupScheduleModal = true;
		},
		closeSetBackupScheduleModal() {
			this.showSetBackupScheduleModal = false;
			this.newBackupSchedule = ""; // æ¸…ç©ºè¾“å…¥æ¡†
		},
		setBackupScheduleRequest(){
			if(this.newBackupSchedule && !isNaN(this.newBackupSchedule) && this.newBackupSchedule > 0){
				const intervalInMilliseconds = this.newBackupSchedule * 1000;
				uni.showLoading({
					title: 'æ­£åœ¨ä¿®æ”¹ä¸­...', // åŠ è½½åŠ¨ç”»çš„æç¤ºæ–‡å­—
					mask: true // é˜»æ­¢ç‚¹å‡»èƒŒæ™¯æ—¶å…³é—­åŠ è½½æç¤º
				});
				uni.request({
					url: `${this.apiUrl}/admin/setBackupInterval?interval=${intervalInMilliseconds}`,
					method: 'GET',
					success: (res) => {
						if(res.data.code==='000'){
							this.showError("å¤‡ä»½å‘¨æœŸå·²æ›´æ–°", "#28a745");
							uni.showToast({
							    title: 'æ›´æ–°æˆåŠŸ',  // æç¤ºçš„æ–‡æœ¬
							    icon: 'success',       // å¯é€‰å€¼ï¼š'success', 'loading', 'none'ï¼Œåˆ†åˆ«è¡¨ç¤ºæˆåŠŸæç¤ºã€åŠ è½½æç¤ºå’Œæ²¡æœ‰å›¾æ ‡çš„æç¤º
							    duration: 1000      // æç¤ºæ¡†çš„æ˜¾ç¤ºæ—¶é•¿ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤2000ms
							});
						}
						else{
							this.showError("å¤‡ä»½å‘¨æœŸæ›´æ–°å¤±è´¥", "#ff4d4f");
						}
					},
					fail: (err) => {
						this.showError("ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•", "#ff4d4f");
					},
					complete: () => {
						uni.hideLoading();
						this.closeSetBackupScheduleModal();
						this.loadBackupSchedule();
					}
				});
			}
			else{
				this.showError("è¯·è¾“å…¥æœ‰æ•ˆæ•°å€¼", "#ff4d4f");
			}
		},
		
		
		
		
		
		
		
		// ä¸‹è½½æ•°æ®åº“å¤‡ä»½æ–‡ä»¶
		// handleDownloadBackupFile() {
		// 	this.showDownloadConfirmationModal = true;
		// },
		// closeDownloadConfirmationModal() {
		// 	this.showDownloadConfirmationModal = false;
		// },
		// downloadBackupFileRequest(){
		// 	if(this.downloadBackupFileResponse===true){
		// 		this.showError("æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼", "#28a745");
		// 	}
		// 	else{
		// 		this.showError("æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼", "#ff4d4f");
		// 	}
		// 	this.closeDownloadConfirmationModal();
		// },
		
		
		
		// ç«‹å³å¤‡ä»½
		handleImmediateBackup() {
			if(!this.who){
				// console.log('Debug: this.who is', this.who); 
				this.showError("è¯·å…ˆç™»å½•ï¼");
				return;
			}
			this.showBackupConfirmationModal = true;
		},
		closeBackupConfirmationModal() {
			this.showBackupConfirmationModal = false;
		},
		immediateBackupRequest(){
			// æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
			uni.showLoading({
				title: 'æ­£åœ¨å¤‡ä»½ä¸­...', // åŠ è½½åŠ¨ç”»çš„æç¤ºæ–‡å­—
				mask: true // é˜»æ­¢ç‚¹å‡»èƒŒæ™¯æ—¶å…³é—­åŠ è½½æç¤º
			});
			uni.request({
				url: `${this.apiUrl}/admin/backupDatabase`, 
				method: 'GET',
				success: (res) => {
					if(res.data.code==='000'){
						this.showError("æ•°æ®åº“å¤‡ä»½æˆåŠŸï¼", "#28a745");
						uni.showToast({
						    title: 'æ“ä½œæˆåŠŸ',  // æç¤ºçš„æ–‡æœ¬
						    icon: 'success',       // å¯é€‰å€¼ï¼š'success', 'loading', 'none'ï¼Œåˆ†åˆ«è¡¨ç¤ºæˆåŠŸæç¤ºã€åŠ è½½æç¤ºå’Œæ²¡æœ‰å›¾æ ‡çš„æç¤º
						    duration: 1000      // æç¤ºæ¡†çš„æ˜¾ç¤ºæ—¶é•¿ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤2000ms
						});
					}
					else{
						this.showError("æ•°æ®åº“å¤‡ä»½å¤±è´¥ï¼", "#ff4d4f");
					}
				},
				fail: (err) => {
					this.showError("ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•", "#ff4d4f");
				},
				complete: () => {
					uni.hideLoading();
					this.closeBackupConfirmationModal();
				}
			});
		},










			// é¡¶éƒ¨å¼¹çª—
			showError(message, color = "#ff4d4f") {
				this.errorMessage = message; // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
				this.errorPopBackgroundColor = color; // è®¾ç½®å¼¹çª—èƒŒæ™¯è‰²
				if (this.timeoutId) {
					clearTimeout(this.timeoutId); // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
				}
				this.timeoutId = setTimeout(() => {
					this.errorMessage = ""; // éšè—é”™è¯¯ä¿¡æ¯
					this.timeoutId = null; // æ¸…é™¤å®šæ—¶å™¨
				}, 1200); // 1.2ç§’åéšè—é”™è¯¯ä¿¡æ¯
			},
		
		
		
		// åº•éƒ¨ç‚¹å‡»å¯¼èˆªæ æŒ‰é’®åˆ‡æ¢é¡µé¢
		// goToHome() {
		// 	uni.redirectTo({
		// 		url: `/pages/index/admin/admin1?id=${this.who}`  // æ·»åŠ  id å‚æ•°
		// 	});

		// },
		// goToTeachers() {
		// 	uni.redirectTo({
		// 		url: `/pages/index/admin/admin2?id=${this.who}`  // æ·»åŠ  id å‚æ•°
		// 	});

		// },
		// goToProfile() {
		// 	uni.pageScrollTo({
		// 		scrollTop: 0, // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
		// 		duration: 500, // æ»šåŠ¨åŠ¨ç”»çš„æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
		// 	});
		// },
		
		
		goToHome() {
			if(this.who){
				uni.redirectTo({
					url: `/pages/index/admin/admin1?id=${this.who}`  // æ·»åŠ  id å‚æ•°
				});
			}
			else{
				uni.reLaunch({
					url: "/pages/index/admin/admin1"
				});
			}
		
		},
		goToTeachers() {
			if(this.who){
				uni.redirectTo({
					url: `/pages/index/admin/admin2?id=${this.who}`  // æ·»åŠ  id å‚æ•°
				});
			}
			else{
				uni.reLaunch({
					url: "/pages/index/admin/admin2"
				});
			}
		},
		goToProfile() {
			uni.pageScrollTo({
				scrollTop: 0, // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
				duration: 500, // æ»šåŠ¨åŠ¨ç”»çš„æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
			});
		},
	},
    
};
</script>


